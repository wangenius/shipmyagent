---
title: Tasks & Automation
description: Schedule and manage automated tasks with ShipMyAgent
---

# Tasks & Automation

Automate repetitive work with ShipMyAgent’s **Task System**: define a task as Markdown, schedule it with cron, keep a full on-disk audit trail per run, and notify a target `chatKey` when it finishes.

## Directory layout

Tasks live under `.ship/task/` (note: `task`, not `tasks`):

```text
.ship/task/
  <task_id>/
    task.md
    <timestamp>/
      messages.jsonl
      input.md
      output.md
      result.md
      dialogue.md
      dialogue.json
      error.md        (optional)
      run.json
      *.md            (optional, extra audit/process files)
```

- `task.md` is the task definition (YAML frontmatter + Markdown body).
- Each run creates a new `<timestamp>/` folder (sorted by time) with audit artifacts.

## Task definition: `<task_id>/task.md`

`task.md` must start with YAML frontmatter and include these required fields:

- `title`
- `cron`
- `description`
- `chatKey`
- `status`

If you want a manual-only task, use `cron: "@manual"` (the field still exists, but the scheduler won’t register it).

Optional result-check fields:

- `requiredArtifacts`: string array; files that must exist in the current run directory (relative paths)
- `minOutputChars`: minimum output length in characters (default `1`; set `0` to allow empty output)
- `maxDialogueRounds`: max rounds for executor agent and user-simulator agent (default `3`)

`requiredArtifacts` can include standard runner artifacts such as `input.md`, `output.md`, `result.md`, and `run.json`.

### Example

```markdown
---
title: Daily Repo Health Check
cron: "0 9 * * 1-5"
description: Run checks and post a short summary
chatKey: telegram-chat-123456789
status: enabled
timezone: Asia/Shanghai
requiredArtifacts:
  - result.md
  - output.md
minOutputChars: 50
maxDialogueRounds: 4
---

Run the following checks and write the final result to `result.md` in the run directory:

1) Pull latest changes (if appropriate)
2) Run tests
3) Summarize failures (if any) and next actions

Constraints:
- Keep outputs auditable: write key artifacts as Markdown files under the run directory.
```

## Result validation model

ShipMyAgent runs tasks with a **two-agent dialogue loop**:

1. **Executor agent** produces/updates the task output.
2. **User-simulator agent** replies as a demanding user and decides whether it is satisfied.
3. The loop continues until satisfied, or `maxDialogueRounds` is reached.

Each run records three statuses in `run.json`:

- `executionStatus`: whether agent execution itself succeeded
- `resultStatus`: whether output/artifacts satisfied task constraints
- `status`: final combined status (`success`/`failure`/`skipped`)

By default, ShipMyAgent enforces `minOutputChars >= 1`. If your task intentionally writes only files and no text output, set `minOutputChars: 0`.

### `status` values

- `enabled`: scheduled by cron (unless `cron: "@manual"`).
- `paused`: not scheduled, but can be run manually.
- `disabled`: not scheduled.

## Cron expressions

ShipMyAgent uses `node-cron` compatible 5-field expressions:

`minute hour day-of-month month day-of-week`

```text
┌───────────── minute (0 - 59)
│ ┌───────────── hour (0 - 23)
│ │ ┌───────────── day of month (1 - 31)
│ │ │ ┌───────────── month (1 - 12)
│ │ │ │ ┌───────────── day of week (0 - 7, 0 and 7 = Sunday)
│ │ │ │ │
* * * * *
```

Shortcuts:

- `@manual` (manual only)
- `@hourly`, `@daily`, `@weekly`, `@monthly`, `@yearly`

## Running and managing tasks

The Task System is primarily driven via **built-in tools** (so the Agent can create/list/run tasks).

### Tools

- `task_list`: list tasks (reads `.ship/task/*/task.md`)
- `create_task`: create `.ship/task/<task_id>/task.md` from inputs
- `run_task`: run once immediately (creates a new run folder and notifies `chatKey`)

For CLI control, you can also use `sma task update <taskId> ...` to modify task config without editing `task.md` manually.  
Use `--clear-*` flags (for example `--clear-required-artifacts`) when you need to unset optional fields.

### Scheduler

The cron scheduler runs when your runtime is running (for example, when you launch `shipmyagent run` or `shipmyagent start` and keep the process alive). Only tasks with:

`status: enabled` and `cron != "@manual"`

are registered.

## Notifications

After a run completes (success or failure), ShipMyAgent sends a summary message to `chatKey` and includes the run directory path.

If you use QQ as `chatKey`, ShipMyAgent may need the latest `messageId` from that chat’s history to send a reply. If delivery fails, ask the target chat to send a message first so ShipMyAgent can record the latest metadata.

## Built-in Skill: Task System

ShipMyAgent ships a built-in skill (Claude Code compatible) named **“Task System（定时任务）”** that explains recommended workflows using these tools:

1. `task_list`
2. `create_task`
3. `run_task`

Use `skills_list` / `skills_load` to find and load it.
