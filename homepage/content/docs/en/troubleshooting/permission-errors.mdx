---
title: Permission Errors
description: Understanding and resolving access control issues
---

# Permission Errors

ShipMyAgent's permission system is designed for security. This guide helps you understand and resolve permission-related issues.

## Understanding Permissions

ShipMyAgent follows the **Principle of Least Privilege**:

```
┌──────────────────────────────────────────────────────┐
│                Permission System                     │
├──────────────────────────────────────────────────────┤
│                                                      │
│  1. Read Access  → Can read repository files        │
│  2. Write Access → Can modify files (with approval)  │
│  3. Shell Access → Can execute commands              │
│  4. Network      → Can make HTTP requests            │
│                                                      │
│  ⚠️  High-risk operations require approval           │
└──────────────────────────────────────────────────────┘
```

## Common Permission Errors

### Error: `zsh: permission denied: shipmyagent`

This is usually not ShipMyAgent’s permission system. It’s almost always an **OS execute-bit (`+x`)** issue on the CLI entry file.

In some setups, `pnpm` creates `node_modules/.bin/shipmyagent` as a symlink directly to the package’s `bin/cli.js`. If the target file is `0644` (not executable), zsh will refuse to run it.

**Fix**:

```bash
# Make the entry file executable
chmod +x node_modules/shipmyagent/bin/cli.js

# Or run via node (doesn't require +x)
node node_modules/shipmyagent/bin/cli.js .
```

### Error: "Permission denied: read access"

**Problem**: Agent cannot read repository files.

**Diagnosis**:
```bash
# Check current permissions
shipmyagent doctor

# View permission settings
cat ship.json | grep -A 10 permissions
```

**Solution**:
```json
{
  "permissions": {
    "read_repo": true  // Enable read access
  }
}
```

### Error: "Permission denied: write access"

**Problem**: Agent cannot write to files.

**Diagnosis**:
```bash
# Check write permissions
shipmyagent logs | grep "write\|permission"

# Test file write
shipmyagent test --operation write
```

**Solutions**:

1. **Enable write access**:
   ```json
   {
     "permissions": {
       "write_repo": {
         "paths": ["src/**", "docs/**"],  // Specify paths
         "requiresApproval": true  // Require approval
       }
     }
   }
   ```

2. **Add more paths**:
   ```json
   {
     "permissions": {
       "write_repo": {
         "paths": [
           "src/**",
           "docs/**",
           "tests/**",
           "*.md"
         ]
       }
     }
   }
   ```

3. **Allow all paths (not recommended)**:
   ```json
   {
     "permissions": {
       "write_repo": {
         "paths": ["**"]  // All files
       }
     }
   }
   ```

### Error: "Permission denied: shell execution"

**Problem**: Agent cannot execute shell commands.

**Solution**:
```json
{
  "permissions": {
    "exec_shell": {
      "allow": [
        "ls *",
        "cat *",
        "find *",
        "rg *",
        "grep *",
        "git *",
        "npm *"
      ],
      "requiresApproval": true  // Ask before running
    }
  }
}
```

### Error: "Approval required but no approval channel"

**Problem**: Agent needs approval but no way to request it.

**Solution**:
```json
{
  "permissions": {
    "write_repo": {
      "paths": ["src/**"],
      "requiresApproval": true
    }
  },
  "integrations": {
    "telegram": {
      "enabled": true,
      "botToken": "${TELEGRAM_BOT_TOKEN}",
      "chatId": "${TELEGRAM_CHAT_ID}"  // Required for approval
    }
  }
}
```

## Permission System Deep Dive

### Permission Levels

| Level | Description | Use Case |
|-------|-------------|----------|
| **Read** | View files | Code review, analysis |
| **Write (Auto)** | Modify files without asking | Safe paths, trusted operations |
| **Write (Manual)** | Modify files with approval | Risky paths, production code |
| **Execute** | Run shell commands | Tests, builds, deployments |
| **Network** | HTTP requests | API calls, webhooks |

### Path Matching

ShipMyAgent uses glob patterns for path matching:

```json
{
  "permissions": {
    "write_repo": {
      "paths": [
        "src/**",           // All files in src/
        "docs/**/*.md",     // Only .md files in docs/
        "tests/*.test.js",  // Test files in tests/
        "*.json"            // JSON files in root
      ]
    }
  }
}
```

**Pattern Examples**:
- `**` - Match all files recursively
- `*` - Match files in current directory
- `**/*.js` - Match all .js files
- `src/**` - Match everything under src/
- `!secret.txt` - Exclude specific file

## Troubleshooting Permission Issues

### Issue: Agent Can't Read Files

**Symptoms**:
- "File not found" errors
- Empty responses when asking about code

**Diagnosis**:
```bash
# Check read permission
cat ship.json | jq '.permissions.read_repo'

# Test file access
shipmyagent test --read src/index.js
```

**Fix**:
```json
{
  "permissions": {
    "read_repo": true
  }
}
```

### Issue: Agent Can't Modify Files

**Symptoms**:
- "Permission denied" when trying to edit
- No files changed after operation

**Diagnosis**:
```bash
# Check write paths
cat ship.json | jq '.permissions.write_repo.paths'

# Test write access
shipmyagent test --write test.txt
```

**Fix**:
```json
{
  "permissions": {
    "write_repo": {
      "paths": ["**"],  // or specific paths
      "requiresApproval": false  // or true for manual approval
    }
  }
}
```

### Issue: Approval Requests Not Working

**Symptoms**:
- Agent hangs waiting for approval
- No notification received

**Diagnosis**:
```bash
# Check Telegram integration
cat ship.json | jq '.integrations.telegram'

# Test Telegram connection
shipmyagent test --integration telegram
```

**Fix**:
1. **Ensure Telegram is configured**:
   ```json
   {
     "integrations": {
       "telegram": {
         "enabled": true,
         "botToken": "${TELEGRAM_BOT_TOKEN}",
         "chatId": "12345678"  // Your chat ID
       }
     }
   }
   ```

2. **Verify bot can send messages**:
   ```bash
   curl -X POST "https://api.telegram.org/bot<token>/sendMessage" \
     -d "chat_id=12345678" \
     -d "text=Test message"
   ```

3. **Disable approval for testing**:
   ```json
   {
     "permissions": {
       "write_repo": {
         "requiresApproval": false  // Auto-approve
       }
     }
   }
   ```

### Issue: Shell Commands Blocked

**Symptoms**:
- "Command not allowed" errors
- Tests or builds don't run

**Diagnosis**:
```bash
# Check allowed commands
cat ship.json | jq '.permissions.exec_shell.allow'

# Test command execution
shipmyagent test --exec "npm test"
```

**Fix**:
```json
{
  "permissions": {
    "exec_shell": {
      "allow": [
        "ls *",            // Basic exploration
        "cat *",
        "find *",
        "rg *",
        "grep *",
        "npm *",           // All npm commands
        "git *",           // All git commands
        "node *",          // Node scripts
        "pytest"           // Specific command
      ],
      "requiresApproval": false  // or true
    }
  }
}
```

## Security Best Practices

### 1. Use Specific Paths

```json
// ❌ Too permissive
{
  "permissions": {
    "write_repo": {
      "paths": ["**"]
    }
  }
}

// ✅ More secure
{
  "permissions": {
    "write_repo": {
      "paths": ["src/**", "tests/**"]
    }
  }
}
```

### 2. Require Approval for Risky Operations

```json
{
  "permissions": {
    "write_repo": {
      "paths": ["src/**"],
      "requiresApproval": true  // Ask before modifying
    },
    "exec_shell": {
      "allow": ["npm test"],
      "requiresApproval": false  // Safe commands
    }
  }
}
```

### 3. Exclude Sensitive Files

```json
{
  "permissions": {
    "write_repo": {
      "paths": ["**"],
      "exclude": [
        ".env",
        "*.key",
        "secrets/**",
        "config/production.json"
      ]
    }
  }
}
```

### 4. Use Environment Variables for Secrets

```json
// ❌ Don't hardcode secrets
{
  "llm": {
    "apiKey": "sk-ant-123456789"
  }
}

// ✅ Use environment variables
{
  "llm": {
    "apiKey": "${ANTHROPIC_API_KEY}"
  }
}
```

## Advanced Permission Patterns

### Role-Based Permissions

Define different permissions for different contexts:

```json
{
  "permissions": {
    "read_repo": true,
    "write_repo": {
      "paths": {
        "development": ["**"],
        "production": ["src/**", "docs/**"]
      },
      "requiresApproval": {
        "development": false,
        "production": true
      }
    }
  },
  "environment": "development"  // or "production"
}
```

### Time-Based Permissions

Limit operations to certain hours:

```json
{
  "permissions": {
    "write_repo": {
      "paths": ["**"],
      "allowedHours": [9, 10, 11, 12, 13, 14, 15, 16, 17],
      "requiresApproval": true
    }
  }
}
```

### Conditional Permissions

Grant permissions based on conditions:

```json
{
  "permissions": {
    "exec_shell": {
      "allow": ["npm deploy"],
      "conditions": {
        "branch": "main",
        "testsPassed": true,
        "requiresApproval": true
      }
    }
  }
}
```

## Debugging Permissions

### Enable Permission Logging

```json
{
  "logging": {
    "level": "debug",
    "permissions": {
      "logAll": true,      // Log all permission checks
      "logDenials": true   // Log denied requests
    }
  }
}
```

### Test Permissions

```bash
# Test all permissions
shipmyagent test --permissions

# Test specific permission
shipmyagent test --permission write_repo

# View permission matrix
shipmyagent permissions --matrix
```

### Permission Audit

Review what the agent can do:

```bash
# Generate permission report
shipmyagent audit --permissions > permissions-report.txt

# Output example:
# Read Access: ENABLED
# Write Access:
#   - src/**: AUTO-APPROVED
#   - docs/**: REQUIRES APPROVAL
# Shell Access:
#   - npm test: ALLOWED
#   - npm deploy: REQUIRES APPROVAL
```

## Next Steps

- [Common Issues](/docs/troubleshooting/common-issues) - General troubleshooting
- [Logs & Debugging](/docs/troubleshooting/logs-debugging) - Understanding logs
- [Performance Issues](/docs/troubleshooting/performance-issues) - Optimization tips
- [Configuration](/docs/configuration) - Full configuration reference
