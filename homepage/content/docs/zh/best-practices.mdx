---
title: 最佳实践
description: 有效和安全地使用 ShipMyAgent 的指南
---

# 最佳实践

遵循这些准则，可以高效、安全、可维护地使用 ShipMyAgent。

## 概述

本章节涵盖：

- [Prompt 编写](#prompt-编写) - 如何编写有效的提示
- [安全检查清单](#安全检查清单) - 必要的安全实践
- [团队上手](#团队上手) - 让您的团队开始使用
- [反模式](#反模式) - 避免常见错误

---

## Prompt 编写

编写有效的提示是从 ShipMyAgent 获得良好结果的关键。

### 核心原则

1. **明确具体** - 清晰的说明减少歧义
2. **提供上下文** - 包含相关的项目信息
3. **设定约束** - 定义 agent 不应该做什么
4. **使用示例** - 展示所需的输出格式
5. **迭代改进** - 根据结果优化提示

### 编写有效的 Agent.md

**良好的 Agent.md 结构**：

```markdown
# 角色

你是一位专注于 React 性能优化的高级前端工程师。

## 上下文

本项目使用：
- React 18 with TypeScript
- Tailwind CSS 用于样式
- Redux Toolkit 用于状态管理

## 目标

- 审查所有代码变更的性能问题
- 建议组件渲染优化
- 确保整个项目的代码风格一致

## 约束

- 绝不修改 src/ 目录之外的文件
- 始终保持现有测试覆盖率
- 未经批准不得更改 API 契约
- 使用 TypeScript 严格模式 - 不允许 `any` 类型

## 输出格式

审查代码时：
1. 用 1-2 句话总结变更
2. 列出发现的问题（严重程度：高/中/低）
3. 提供具体的改进建议
4. 对于复杂问题包含代码示例

## 示例

如果审查 React 组件：

**输入**：一个使用 `useEffect` 获取数据的新组件

**良好输出**：
```
此组件在挂载时获取用户数据。

问题：
- 中：缺少加载状态
- 低：请求失败时没有错误处理

建议：添加 loading/error 状态的 useState

### 更好提示的技巧

#### 1. 使用"5 W"原则

- **Who（谁）** - agent 的角色是什么？
- **What（什么）** - 它应该完成什么？
- **Where（哪里）** - 它应该在哪里操作（文件路径）？
- **When（何时）** - 它应该何时采取行动（触发器）？
- **Why（为什么）** - 为什么这很重要（上下文）？

#### 2. 明确格式

```markdown
## 响应格式

始终使用此结构响应：

## 摘要
[简要的 1-2 句话总结]

## 变更
- [文件 1]：[描述]
- [文件 2]：[描述]

## 风险
- [风险 1]：[缓解措施]
```

#### 3. 提供负面示例

```markdown
## 不要做

❌ 不要使用 `any` 类型
❌ 不要忽略 TypeScript 错误
❌ 未经明确请求不要修改测试

## 而是做

✅ 使用适当的 TypeScript 类型
✅ 提交前修复类型错误
✅ 保持测试与代码更改同步
```

#### 4. 设置清晰的边界

```markdown
## 超出范围

不要尝试：
- 修改 package.json 依赖
- 更改部署配置
- 更改数据库架构
- 重写整个模块（仅重构）

这些需要明确的人工批准。
```

### 特定任务的提示模式

#### 代码审查任务

```markdown
---
id: pr-review
name: PR 审查 Agent
---

审查此拉取请求，重点关注：
1. **安全性**：任何漏洞或敏感数据泄露
2. **性能**：潜在的瓶颈或低效代码
3. **可维护性**：代码复杂度和可读性
4. **测试**：足够的测试覆盖率

对于每个问题，指定：
- 文件和行号
- 严重程度（严重/高/中/低）
- 建议的修复
- 适用时提供代码示例
```

#### 维护任务

```markdown
---
id: dependency-check
name: 依赖健康检查
cron: "0 9 * * 1"
---

检查：
1. 过时的依赖（> 30 天）
2. 已知的安全漏洞
3. 已弃用的软件包
4. 当前软件包的更好替代方案

报告格式：
## 🔴 严重更新
[软件包]：[当前] → [最新] - [原因]

## ⚠️ 建议更新
[软件包]：[当前] → [最新]

## ✅ 一切正常
如果没有发现问题，确认一切都是最新的。
```

#### 文档任务

```markdown
---
id: doc-sync
name: 文档同步
cron: "0 18 * * 5"
---

确保文档与代码同步：

1. 检查新 API/功能是否已记录
2. 验证文档中的示例适用于当前代码
3. 如需要更新变更日志
4. 标记文档中任何已弃用的功能

输出：
- 需要更新的文件
- 缺失的文档
- 发现的不一致之处
```

---

## 安全检查清单

使用 ShipMyAgent 时的基本安全实践。

### ✅ 始终要做

#### 1. 对密钥使用环境变量

```bash
# .env（添加到 .gitignore！）
ANTHROPIC_API_KEY=sk-ant-...
TELEGRAM_BOT_TOKEN=123456:...
DATABASE_URL=postgres://...
```

```json
// ship.json
{
  "llm": {
    "apiKey": "${ANTHROPIC_API_KEY}"  // ✅ 良好
  }
}
```

#### 2. 限制文件访问

```json
{
  "permissions": {
    "write_repo": {
      "paths": ["src/**", "docs/**"],
      "exclude": [
        ".env",
        "*.key",
        "secrets/**",
        "config/prod/**"
      ]
    }
  }
}
```

#### 3. 对有风险的操作启用批准

```json
{
  "permissions": {
    "write_repo": {
      "paths": ["**"],
      "requiresApproval": true  // ✅ 需要批准
    },
    "exec_shell": {
      "allow": ["npm deploy"],
      "requiresApproval": true  // ✅ 关键！
    }
  }
}
```

#### 4. 验证用户输入

```markdown
# Agent.md

## 安全规则

- 在没有清理的情况下永远不要执行带有用户输入的命令
- 在读/写之前验证文件路径
- 拒绝对敏感文件的操作（.env、.key 等）
- 将可疑请求升级给人工批准
```

#### 5. 定期审计

```bash
# 每月安全审计
shipmyagent audit --permissions
shipmyagent audit --tasks
shipmyagent audit --logs --level error
```

### ❌ 永远不要做

#### 1. 硬编码密钥

```json
// ❌ 永远不要这样做
{
  "llm": {
    "apiKey": "sk-ant-1234567890abcdef"
  }
}
```

#### 2. 允许无限制的 Shell 访问

```json
// ❌ 危险！
{
  "permissions": {
    "exec_shell": {
      "allow": ["*"]  // 允许任何命令！
    }
  }
}
```

#### 3. 禁用所有权限

```json
// ❌ 不要给予无限访问权限
{
  "permissions": {
    "write_repo": {
      "paths": ["**"],
      "requiresApproval": false,  // 自动批准所有内容！
      "exclude": []
    }
  }
}
```

#### 4. 忽略错误日志

```bash
# ❌ 不要忽略错误
shipmyagent logs --level error  # 定期查看这些！
```

### 安全监控

设置安全警报：

```json
{
  "monitoring": {
    "alerts": {
      "unusualActivity": {
        "enabled": true,
        "notify": ["telegram", "email"]
      },
      "failedApprovals": {
        "threshold": 3,
        "action": "lockdown"
      },
      "suspiciousCommands": {
        "patterns": ["rm -rf", "sudo", "chmod 777"],
        "action": "block_and_notify"
      }
    }
  }
}
```

---

## 团队上手

让您的团队快速上手 ShipMyAgent。

### 第一阶段：设置（第 1 周）

#### 第 1-2 天：核心团队试点

1. **选择试点团队成员**（2-3 名开发人员）
2. **在测试项目中安装 ShipMyAgent**
3. **配置基本权限**
4. **运行初始任务**并审查结果

```markdown
## 试点团队检查清单

- [ ] 安装 ShipMyAgent
- [ ] 配置 LLM API key
- [ ] 创建初始 Agent.md
- [ ] 设置 Telegram（可选）
- [ ] 运行测试任务
- [ ] 审查和调整提示
```

#### 第 3-5 天：迭代和文档

1. **根据试点反馈优化 Agent.md**
2. **记录常见任务**
3. **创建团队特定指南**
4. **设置共享资源**

### 第二阶段：推广（第 2-3 周）

#### 培训会议

**会议 1：介绍**（30 分钟）

```markdown
## 议程：什么是 ShipMyAgent？

1. 概述和演示（10 分钟）
2. 主要功能和好处（5 分钟）
3. 安全和权限（5 分钟）
4. 问答（10 分钟）

## 资料
- 快速入门指南
- 安全最佳实践
- 团队指南
```

**会议 2：动手实践**（60 分钟）

```markdown
## 议程：开始使用

1. 安装和设置（15 分钟）
2. 编写第一个 Agent.md（15 分钟）
3. 创建和运行任务（15 分钟）
4. 审查和故障排查（15 分钟）

## 先决条件
- 已安装 Node.js >= 18
- 准备好 LLM API key
- 已克隆测试项目
```

#### 团队指南

创建共享指南文档：

```markdown
# 团队 ShipMyAgent 指南

## 何时使用

✅ 适用于：
- PR 前的代码审查
- 例行维护任务
- 文档更新
- 测试生成

❌ 不适用于：
- 紧急修复（使用手动审查）
- 复杂重构（需要人工设计）
- 破坏性更改（需要团队讨论）

## 权限策略

- 所有团队成员：读取权限
- 高级开发人员：写入权限（需要批准）
- 技术主管：完全访问权限（部署需要批准）

## 批准工作流程

1. Agent 提议变更
2. 发送通知到 Telegram
3. 审查者批准/拒绝
4. Agent 执行或修订

## 审查时间表

- 每周：审查任务性能
- 每月：更新提示和权限
- 每季度：完整的安全审计
```

### 第三阶段：优化（第 4 周及以上）

#### 收集指标

```bash
# 跟踪团队使用情况
shipmyagent metrics --team

# 生成月度报告
shipmyagent report --month > monthly-report.txt
```

#### 要跟踪的指标

| 指标 | 目标 | 如果低则采取行动 |
|------|------|------------------|
| **任务成功率** | > 90% | 审查提示 |
| **批准率** | < 30% | 调整权限 |
| **节省的时间** | > 5 小时/周 | 扩大使用 |
| **团队满意度** | > 4/5 | 收集反馈 |

#### 持续改进

1. **每周回顾**（15 分钟）
   - 什么运作良好？
   - 什么需要改进？
   - 下周的行动项

2. **分享成功故事**
   ```markdown
   ## 团队成功 🎉

   ### 第 2 周：自动化代码审查
   - 节省了 8 小时审查时间
   - 发现了 3 个严重错误
   - 团队满意度：4.5/5

   ### 第 3 周：文档同步
   - 自动更新了 50+ 文档页面
   - 减少了 40% 的文档债务
   ```

3. **定期更新提示**
   ```bash
   # 安排提示审查
   shipmyagent prompts review --team

   # A/B 测试新提示
   shipmyagent prompts test --variant-b
   ```

---

## 反模式

常见错误及如何避免它们。

### ❌ 反模式 1：模糊的提示

**问题**：
```markdown
# Agent.md

你是一个有帮助的助手。帮助我处理代码。
```

**为什么不好**：
- 没有清晰的角色或重点
- 没有约束或边界
- 不可预测的行为
- 输出质量差

**✅ 更好的方法**：
```markdown
# Agent.md

你是一位专注于性能优化的高级 React 工程师。

## 范围
- 审查 React 组件代码
- 识别性能瓶颈
- 建议优化策略

## 约束
- 仅分析 src/ 中的文件
- 不要建议重写
- 提供可测试的建议
```

### ❌ 反模式 2：忽略错误

**问题**：
```bash
# 只是忽略错误日志
shipmyagent logs --level error  # ✗ 从未审查
```

**为什么不好**：
- 静默失败累积
- 安全问题未被注意
- 性能随时间下降
- 任务静默停止工作

**✅ 更好的方法**：
```bash
# 定期日志审查
shipmyagent logs --level error --tail 100

# 设置警报
{
  "monitoring": {
    "alerts": {
      "onError": {
        "notify": ["telegram"],
        "threshold": 1
      }
    }
  }
}
```

### ❌ 反模式 3：任务过载

**问题**：
```markdown
# 太多频繁的任务
---
cron: "*/5 * * * *"  # 每 5 分钟
---
---
cron: "*/10 * * * *"  # 每 10 分钟
---
---
cron: "0 * * * *"  # 每小时
---
```

**为什么不好**：
- 高 LLM API 成本
- 系统性能下降
- 通知疲劳
- 收益递减

**✅ 更好的方法**：
```markdown
# 平衡的任务时间表
---
cron: "0 9 * * *"  # 每日早晨检查
---
---
cron: "0 18 * * *"  # 每日晚间摘要
---
---
cron: "0 9 * * 1"  # 每周深入分析
---
```

### ❌ 反模式 4：一刀切

**问题**：
```markdown
# 对所有内容使用相同的 Agent.md
```

**为什么不好**：
- 缺乏专业化
- 特定任务性能差
- 指令冲突

**✅ 更好的方法**：
```markdown
# Agent.md - 通用目的
# Agent.code-review.md - 专门用于审查
# Agent.docs.md - 专门用于文档
# Agent.tests.md - 专门用于测试
```

### ❌ 反模式 5：没有版本控制

**问题**：
```
.ship/
├── tasks/
│   └── task.md  # ✗ 未跟踪
├── cache/       # ✗ 无限累积
```

**为什么不好**：
- 无法恢复错误的更改
- 没有提示演变的历史
- 清除缓存时丢失工作

**✅ 更好的方法**：
```bash
# .gitignore
.ship/cache/
.ship/logs/*.jsonl
.ship/tmp/

# .gitinclude
.ship/tasks/
Agent.md
ship.json.example
```

---

## 下一步

- [配置](/docs/configuration) - 详细设置指南
- [示例](/docs/examples) - 真实世界的设置
- [故障排查](/docs/troubleshooting) - 问题解决指南
