---
title: Skills（Claude Code 兼容）
description: skills 的目录结构、发现逻辑、工具接口与当前行为说明
---

# Skills（Claude Code 兼容）

ShipMyAgent 当前支持 **Claude Code-compatible skills**。本页解释：skills 如何在磁盘上组织、如何被扫描、如何以工具形式提供给 Agent，以及当前提示词层的行为差异。

## 目录结构

默认会扫描 2 类 skills roots：

- 项目内：`<project>/.ship/skills`
- 用户目录：`~/.ship/skills`

此外，你还可以通过 `ship.json.services.skills.paths` 增加额外 roots。`sma init` 会默认在 `ship.json` 写入 `services.skills.paths: [".claude/skills"]`，并创建 `./.claude/skills/` 目录，用于兼容社区常见布局。

项目内 skills 目录结构示例（推荐放在项目根目录下的 `.ship/skills`）：

```text
.ship/skills/
  <skill-id>/
    SKILL.md
    (optional) scripts/
    (optional) assets/
```

- `<skill-id>`：目录名，会作为 skill 的 `id`。
- 必须存在 `SKILL.md`，否则不会被识别为 skill。

## SKILL.md 元数据（front matter）

扫描时会读取 `SKILL.md` 的 YAML front matter，用于展示与检索：

- `name`：显示名（默认等于 `<skill-id>`）
- `description`：描述
- `allowed-tools`（或 `allowedTools` / `allowed_tools`）：工具白名单提示

> `allowed-tools` 会在 **skill 被加载后** 在当前 run 内生效：ShipMyAgent 会把模型可调用的工具限制为“已加载 skill 的 allowed-tools 的并集”（同时会强制保留 `chat_send`，以保证 agent 仍能对用户输出）。

## skills roots 的解析规则

可以在 `ship.json` 配置 `services.skills`：

```json
{
  "services": {
    "skills": {
      "paths": [".claude/skills", ".my/skills"],
      "allowExternalPaths": false
    }
  }
}
```

解析规则要点：

- `paths` 支持相对路径（相对项目根目录）、绝对路径、`~` 展开（用于额外 roots）。
- 如果某个 root 的 basename 不是 `skills`，且其子目录 `skills/` 存在，则优先扫描 `<root>/skills/`（兼容 `.claude/skills` 这类布局）。
- 默认 `allowExternalPaths=false`：只扫描“项目内路径 + 用户目录”。如果你在 `paths` 里配置了项目外的绝对路径/`~` 路径，需要把 `allowExternalPaths` 设为 `true` 才会扫描。

## Agent 如何“使用 skills”

skills 通过两个内置工具提供给模型：

- `skills_list`：列出可用 skills（含 `id/name/description/allowedTools`）
- `skills_load`：按 `id/name` 查找并加载对应 `SKILL.md` 全文

典型工作流：

1. 模型调用 `skills_list` 发现是否有合适的 skill
2. 调用 `skills_load` 读取 `SKILL.md`
3. 按 `SKILL.md` 的步骤执行（必要时再调用其它工具；工具权限可能会被 `allowed-tools` 限制）

> 说明：当模型调用 `skills_load` 成功后，ShipMyAgent 会把该 `skillId` 持久化到当前 `chatKey` 的 `.ship/chat/<encodedChatKey>/messages/meta.json`（pinnedSkillIds），后续每次对话都会自动注入对应 `SKILL.md`；在 history compact 时系统可能自动移除不再需要的 pinned skills。

## system prompt 中的 skills section

当前 `shipmyagent start` 与聊天适配器默认都会把 skills 摘要 section 拼进 system prompt（`Agent.md` 拼接结果），让模型在对话一开始就知道：

- skills roots 是哪些
- 应优先用 `skills_list / skills_load` 来发现与加载 skills
- 当前发现了哪些 skills（最多列出 40 个）

## CLI：安装与查找（可选）

ShipMyAgent 提供了一个对标 `npx skills` 的包装命令（内部仍是调用 `npx skills`）：

- 查找：`sma skill find react|nextjs|design`
- 安装：`sma skill add vercel-labs/agent-skills@vercel-react-best-practices`（会同步到 `~/.ship/skills`）
- 列出当前项目可发现 skills：`sma skill list`
