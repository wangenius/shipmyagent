---
title: Telegram
description: 通过 Telegram 与 Agent 对话并接收审批/结果通知
---

# Telegram 集成

> ⚠️ **简化模式（2026-02-03）**：当前发布的 `shipmyagent` 包已暂时移除审批与任务系统（默认全权限执行）。旧文档里关于“审批提示/任务结果通知”的描述可能已过期。

使用 Telegram 和 ShipMyAgent 对话（私聊或群里 @）。

> 想了解内部怎么跑起来的？看这篇：[/docs/integrations/telegram-message-flow](/docs/integrations/telegram-message-flow)

## 配置步骤

### 1）创建 Telegram 机器人

1. 打开 Telegram，搜索 `@BotFather`
2. 发送 `/newbot`
3. 按提示设置名称与用户名
4. 复制 **HTTP API Token**

### 2）写入项目配置

把 token 放到项目根目录的 `.env`（与 `ship.json` 同目录）：

```bash
TELEGRAM_BOT_TOKEN=123456:abc...
```

在 `ship.json` 启用 Telegram：

```json
{
  "integrations": {
    "telegram": {
      "enabled": true,
      "botToken": "${TELEGRAM_BOT_TOKEN}"
    }
  }
}
```

> ShipMyAgent 的聊天回复采用 tool-strict：Agent 需要使用 `chat_send` 工具自行决定何时发消息（可以分多条、分阶段发送）。

### 可选：群聊允许所有人使用

默认情况下，群聊会限制为「发起人（在该群/话题里第一个和机器人说话的人）」或「群管理员」才能与机器人对话。

如果你希望群里**任何成员**（在 `@bot` 或回复 bot 消息时）都可以和机器人聊天，配置：

```json
{
  "integrations": {
    "telegram": {
      "enabled": true,
      "botToken": "${TELEGRAM_BOT_TOKEN}",
      "groupAccess": "anyone"
    }
  }
}
```

### 3）启动 ShipMyAgent

```bash
shipmyagent start
```

日志里看到以下内容说明启动成功：

- `Starting Telegram Bot...`
- `Bot username: @...`
- `Telegram Bot started`

## 使用方式

### 私聊

给机器人发 `/start`（或任意消息）即可开始对话。

### 发送文件（PDF / 图片 / 音频）

你可以直接给机器人发送文件（document/photo/voice/audio）。

- 如果你在发送文件时同时输入文字，Telegram 会把这段文字当作 **caption（附件说明）** —— ShipMyAgent 会把 caption 当作你的指令来处理。
- ShipMyAgent 会把文件保存到 `.ship/.cache/telegram/`，并以 `@attach ...` 的形式传给 Agent。

示例：发送一个 PDF，并在 caption 写：`帮我总结这个 PDF，并列出待办事项。`

### 群聊 / 超级群

- 把机器人拉进群
- 通过 `@你的机器人 用户名 ...` 的方式与它对话
- 当你 `@bot`（或直接回复 bot 的消息）后，短时间内可以不再 `@` 继续追问，机器人仍会根据上下文回复。

说明：
- 如果群开启了 **Topics（话题）**，机器人会尽量在同一个话题里回复。
- 群聊场景下，运行时可能会限制可对话的人（例如仅发起人/群管理员），以避免被滥用。
- 群里发送文件时，如需 `@bot`，请把 `@bot` 写在 **caption** 里，或直接用“回复 bot 消息”的方式发送文件。
- Agent 执行期间会周期性发送 `sendChatAction(typing)`，你会看到 Telegram 的“正在输入”提示，直到结果发出。

## 常见问题排查

- **完全没反应**：确认进程在跑，并查看 `.ship/logs/<YYYY-MM-DD>.jsonl`（可搜索 `TELEGRAM` / `telegram` / error 关键词）。
- **群里收不到消息**：在 BotFather 执行 `/setprivacy` 设为 `Disable`，并确认你是在群里 `@bot`。
- **轮询收不到（getUpdates 冲突）**：如果之前配置过 webhook，会与轮询冲突。ShipMyAgent 启动时会尝试清理 webhook；留意日志里的 webhook/Conflict 报错。
- **群里发不出消息**：检查群权限/管理员设置，机器人可能被禁言或不允许发消息。
